# Project rules (FoodMind / EatFit24)

## 1. Общая информация

- Project root на сервере: `/fitness-app`
- Стек:
  - `/bot` — Telegram-бот на **aiogram 3** (Python)
  - `/backend` — **Django + DRF**, REST API для бота и фронта
  - `/frontend` — **React** (Telegram WebApp мини-ап)

- Главный источник правды по данным и бизнес-логике:
  - БД и модели: `/backend`
  - Бизнес-логика бота: `/bot`
  - UI и Telegram WebApp: `/frontend`

## 2. Порядок изменений

Всегда придерживайся порядка:

1. **Сначала backend**
   - модели, сериализаторы, вьюхи, схемы, миграции;
   - API-контракты считаются первичными.

2. **Потом bot**
   - обновление клиентов к API backend’а;
   - никакой прямой работы бота с БД в обход Django.

3. **Потом frontend**
   - адаптация под актуальные REST-эндпоинты;
   - минимум бизнес-логики во фронте.

Любые изменения должны:
- не ломать существующие публичные endpoint’ы без крайней необходимости;
- по возможности быть обратносovместимыми (миграции/алиасы).

## 3. SSH и работа на сервере

Claude Code **может предлагать подключение по SSH к серверу**, но:

1. **Всегда сначала спрашивай явное разрешение.**
   - Перед любыми SSH-действиями опиши кратко:
     - цель (что именно хотим проверить/пофиксить),
     - какие команды планируешь выполнить,
     - какие сервисы могут быть затронуты.
   - Формат вопроса:  
     *«Можно ли сейчас подключиться по SSH и выполнить команды: … ?»*

2. **Никогда не выполняй деструктивные действия без прямого указания.**
   - Запрещено предлагать:
     - `rm -rf` вне временных/лог-папок,
     - полное удаление БД/volume’ов,
     - полный `docker system prune` и подобные вещи.
   - Любые операции, которые могут привести к потере данных, должны быть явно согласованы.

3. **При работе с Docker:**
   - По умолчанию:
     - использовать точечные команды (`docker compose build backend`, `docker compose up -d backend`);
     - не останавливать все сервисы сразу, если это не требуется.
   - Перезапуск всей системы (`docker compose down` / `up`) — только после моего разрешения.

4. **Диагностика всегда до лечения.**
   - Сначала предлагаешь read-only команды:
     - просмотр логов (`docker logs`, `journalctl`, `psql SELECT`),
     - `docker compose ps`,
     - проверки `/health`-эндпоинтов.
   - Только потом — команды, что меняют состояние.

## 4. Стиль ответов и артефакты

- Давай **чёткий пошаговый план**:
  - сначала high-level (что делаем и зачем),
  - потом конкретные команды с комментариями.
- Если предлагаешь правки в коде:
  - показывай **конкретные фрагменты / diff по файлам**;
  - явно указывай путь до файла от `/backend`, `/bot` или `/frontend`.
- После каждого логического этапа:
  - указывай, **как проверить**, что всё работает (curl, SQL, UI-шаги).

## 5. Приоритеты

1. **Не убить прод.** Любое решение должно быть максимально безопасным для текущих пользователей.
2. **Прозрачность.** Всегда объясняй, что и зачем предлагается сделать.
3. **Минимальные изменения, максимальная ясность.**
