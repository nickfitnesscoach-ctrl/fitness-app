# üì∏ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∑–∞–≥—Ä—É–∑–∫–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ cache busting.

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-25 (–¥–æ–±–∞–≤–ª–µ–Ω—ã: validators, avatar_version, —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)

---

## üîß Backend (Django)

### 1. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª:** `backend/apps/users/models.py`

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—å `Profile`:
```python
avatar = models.ImageField(
    upload_to='avatars/',
    null=True,
    blank=True,
    verbose_name='–ê–≤–∞—Ç–∞—Ä',
    help_text='–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–∞–∫—Å. 5 –ú–ë, —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, WebP)',
    validators=[
        validate_avatar_file_extension,
        validate_avatar_file_size,
    ]
)

avatar_version = models.PositiveIntegerField(
    default=0,
    verbose_name='–í–µ—Ä—Å–∏—è –∞–≤–∞—Ç–∞—Ä–∞',
    help_text='–í–µ—Ä—Å–∏—è –∞–≤–∞—Ç–∞—Ä–∞ –¥–ª—è cache busting (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ)'
)
```

**–ú–µ—Ç–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞:**
```python
def set_avatar(self, new_avatar_file):
    """
    Safely set a new avatar, deleting the old one.

    This method:
    1. Safely deletes the old avatar file if it exists
    2. Sets the new avatar
    3. Increments the avatar_version for cache busting
    4. Saves the profile
    """
```

### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
**–§–∞–π–ª:** `backend/apps/users/validators.py`

–°–æ–∑–¥–∞–Ω—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã:
```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
AVATAR_MAX_SIZE_MB = 5
AVATAR_MAX_SIZE_BYTES = AVATAR_MAX_SIZE_MB * 1024 * 1024
AVATAR_ALLOWED_TYPES = ('image/jpeg', 'image/png', 'image/webp')
AVATAR_ALLOWED_EXTENSIONS = ('.jpg', '.jpeg', '.png', '.webp')

# –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
validate_avatar_file_extension(value)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞
validate_avatar_file_size(value)       # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å 5 –ú–ë)
validate_avatar_mime_type(file)        # –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME —Ç–∏–ø–∞
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å –≤ –º–æ–¥–µ–ª—è—Ö –∏ view
- –õ–µ–≥–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

### 3. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
**–§–∞–π–ª—ã:**
- `backend/apps/users/migrations/0007_profile_avatar.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è avatar
- `backend/apps/users/migrations/0008_add_avatar_validators_and_version.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ avatar_version –∏ validators

### 4. Serializer —Å cache busting
**–§–∞–π–ª:** `backend/apps/users/serializers.py`

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `avatar_url` –≤ `ProfileSerializer` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
```python
avatar_url = serializers.SerializerMethodField()

def get_avatar_url(self, obj):
    """
    Return full URL for avatar if exists.
    Includes version parameter for cache busting.
    """
    if obj.avatar:
        request = self.context.get('request')
        base_url = None

        if request:
            base_url = request.build_absolute_uri(obj.avatar.url)
        else:
            base_url = obj.avatar.url

        # Add version parameter for cache busting
        if obj.avatar_version > 0:
            separator = '&' if '?' in base_url else '?'
            return f"{base_url}{separator}v={obj.avatar_version}"
        return base_url
    return None
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç cache busting:**
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ: `http://example.com/media/avatars/avatar.jpg?v=1`
- –ü—Ä–∏ –∑–∞–º–µ–Ω–µ: `http://example.com/media/avatars/avatar2.jpg?v=2`
- –ë—Ä–∞—É–∑–µ—Ä –≤–∏–¥–∏—Ç –Ω–æ–≤—ã–π URL ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–µ–∂–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –ù–µ –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å –∫–µ—à –≤—Ä—É—á–Ω—É—é

### 5. API View —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
**–§–∞–π–ª:** `backend/apps/users/views.py`

`UploadAvatarView` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤:
- **Endpoint:** `POST /api/v1/users/profile/avatar/`
- **–§–æ—Ä–º–∞—Ç:** `multipart/form-data`
- **–ü–æ–ª–µ:** `avatar`
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã:**
  - `validate_avatar_mime_type(avatar_file)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ MIME —Ç–∏–ø–∞
  - `validate_avatar_file_size(avatar_file)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
  - `validate_avatar_file_extension(avatar_file)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `profile.set_avatar(avatar_file)` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—É—Ç–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ `avatar_version`
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL —Å –≤–µ—Ä—Å–∏–µ–π –¥–ª—è cache busting
  - –í–æ–∑–≤—Ä–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è —Å `avatar_url?v=N`

### 5. URL –º–∞—Ä—à—Ä—É—Ç
**–§–∞–π–ª:** `backend/apps/users/urls.py`
```python
path('profile/avatar/', views.UploadAvatarView.as_view(), name='upload-avatar'),
```

### 6. –†–∞–∑–¥–∞—á–∞ –º–µ–¥–∏–∞
**–§–∞–π–ª:** `backend/config/urls.py`
- –†–∞–∑–¥–∞—á–∞ `/media/` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ DEBUG
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx/Apache

---

## üíª Frontend (React + TypeScript)

### 1. –¢–∏–ø—ã
**–§–∞–π–ª:** `frontend/src/types/profile.ts`
```typescript
export interface Profile {
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
    avatar_url?: string | null; // URL to user's avatar image (with cache busting version)
}
```

### 2. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
**–§–∞–π–ª:** `frontend/src/services/api.ts`

–î–æ–±–∞–≤–ª–µ–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫:
```typescript
export class UnauthorizedError extends Error {
    constructor(message: string = 'Unauthorized') {
        super(message);
        this.name = 'UnauthorizedError';
    }
}

export class ForbiddenError extends Error {
    constructor(message: string = 'Forbidden') {
        super(message);
        this.name = 'ForbiddenError';
    }
}
```

### 3. API –∫–ª–∏–µ–Ω—Ç —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
**–§–∞–π–ª:** `frontend/src/services/api.ts`

–ú–µ—Ç–æ–¥ `uploadAvatar` –æ–±–Ω–æ–≤–ª–µ–Ω:
```typescript
async uploadAvatar(file: File): Promise<Profile> {
    const formData = new FormData();
    formData.append('avatar', file);

    const response = await fetchWithTimeout(URLS.uploadAvatar, {
        method: 'POST',
        headers: buildTelegramHeaders(),
        body: formData,
    });

    if (!response.ok) {
        // Handle authentication errors specifically
        if (response.status === 401) {
            throw new UnauthorizedError('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ –∏–∑ Telegram.');
        }

        if (response.status === 403) {
            throw new ForbiddenError('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ –∏–∑ Telegram.');
        }

        // Handle other errors...
    }

    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å avatar_url –≤–∫–ª—é—á–∞—é—â–∏–º –≤–µ—Ä—Å–∏—é
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 401/403 –æ—à–∏–±–æ–∫
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–ª–∏—á–∞—Ç—å —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –≤ UI

### 4. ProfilePage –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
**–§–∞–π–ª:** `frontend/src/pages/ProfilePage.tsx`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ö–ª–∏–∫ –ø–æ –∞–≤–∞—Ç–∞—Ä—É ‚Üí –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π preview –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ (spinner)
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ –∏–∑ `avatar_url` —Å –≤–µ—Ä—Å–∏–µ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π cache busting)
- ‚úÖ –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (401/403)
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏
- ‚úÖ –û—Ç–∫–∞—Ç –∫ —Å—Ç–∞—Ä–æ–º—É –∞–≤–∞—Ç–∞—Ä—É –ø—Ä–∏ –æ—à–∏–±–∫–µ

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```typescript
try {
    const updatedProfile = await api.uploadAvatar(file);
    setProfile(updatedProfile);
    // Update preview from server URL (with cache busting version parameter)
    setAvatarPreview(updatedProfile.avatar_url || null);
} catch (err: any) {
    // Handle authentication errors specifically
    if (err instanceof UnauthorizedError || err instanceof ForbiddenError) {
        setError('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ –∏–∑ Telegram.');
    } else {
        setError(err.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.');
    }

    // Revert to old avatar on any error
    setAvatarPreview(profile?.avatar_url || null);
}
```

---

## üß™ –¢–µ—Å—Ç—ã

### –§–∞–π–ª —Ç–µ—Å—Ç–æ–≤
**–§–∞–π–ª:** `backend/apps/users/tests/test_avatar_upload.py`

**–°–æ–∑–¥–∞–Ω–æ 22 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–∞:**

#### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (6 —Ç–µ—Å—Ç–æ–≤):
1. –ó–∞–≥—Ä—É–∑–∫–∞ JPEG –∞–≤–∞—Ç–∞—Ä–∞
2. –ó–∞–≥—Ä—É–∑–∫–∞ PNG –∞–≤–∞—Ç–∞—Ä–∞
3. –ó–∞–≥—Ä—É–∑–∫–∞ WebP –∞–≤–∞—Ç–∞—Ä–∞
4. –ó–∞–º–µ–Ω–∞ —Å—Ç–∞—Ä–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ –Ω–æ–≤—ã–º
5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `avatar_url` –≤ –æ—Ç–≤–µ—Ç–µ API
6. –ü–æ–ª—É—á–µ–Ω–∏–µ `avatar_url` —á–µ—Ä–µ–∑ GET `/profile/`

#### ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—à–∏–±–∫–∏ (4 —Ç–µ—Å—Ç–∞):
1. –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ > 5 –ú–ë
2. –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω—ã—Ö MIME —Ç–∏–ø–æ–≤
3. –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–∞
4. –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (401)

#### üîß Serializer (3 —Ç–µ—Å—Ç–∞):
1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ URL —Å request context
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ URL –±–µ–∑ context
3. –í–æ–∑–≤—Ä–∞—Ç `null` –∫–æ–≥–¥–∞ –∞–≤–∞—Ç–∞—Ä–∞ –Ω–µ—Ç

#### üéØ –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ (3 —Ç–µ—Å—Ç–∞):
1. `test_validate_avatar_file_size` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
2. `test_validate_avatar_file_extension` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
3. `test_validate_avatar_mime_type` - –≤–∞–ª–∏–¥–∞—Ü–∏—è MIME —Ç–∏–ø–∞

#### üîÑ –¢–µ—Å—Ç—ã –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ cache busting (4 —Ç–µ—Å—Ç–∞):
1. `test_avatar_version_starts_at_zero` - –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∏–º–µ–µ—Ç version=0
2. `test_avatar_version_increments_on_upload` - –≤–µ—Ä—Å–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
3. `test_avatar_url_includes_version_parameter` - URL —Å–æ–¥–µ—Ä–∂–∏—Ç ?v=N
4. `test_avatar_url_version_updates_on_replace` - –≤–µ—Ä—Å–∏—è –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–º–µ–Ω–µ

#### üóëÔ∏è –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è (2 —Ç–µ—Å—Ç–∞):
1. `test_old_avatar_deleted_on_new_upload` - —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ API
2. `test_set_avatar_method_deletes_old_avatar` - –º–µ—Ç–æ–¥ set_avatar() —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
cd backend
python manage.py test apps.users.tests.test_avatar_upload --settings=config.settings.test
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ 22 —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (0.200s)

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `backend/TEST_AVATAR.md`

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
  - [ ] `0007_profile_avatar.py`
  - [ ] `0008_add_avatar_validators_and_version.py`
- [ ] –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `media/avatars/` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É (–Ω–∞–ø—Ä. 755)
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Pillow —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `pip install Pillow`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–¥ (–≤–∫–ª—é—á–∞—è –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ `/media/`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∞–≤–∞—Ç–∞—Ä–∞ –≤ Telegram mini-app
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL –∞–≤–∞—Ç–∞—Ä–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –≤–µ—Ä—Å–∏–∏ `?v=1`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä –∏ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤–µ—Ä—Å–∏—è —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å `?v=2`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ cache busting —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ ctrl+F5)
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª > 5 –ú–ë (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ —Å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞)
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ —Å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å—Ç–∞—Ä—ã–π –∞–≤–∞—Ç–∞—Ä —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ (401/403)

---

## üéØ Workflow –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –≤ Telegram mini-app
2. –ö–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫—Ä—É–≥ –∞–≤–∞—Ç–∞—Ä–∞ (—Å –∏–∫–æ–Ω–∫–æ–π –∫–∞–º–µ—Ä—ã –ø—Ä–∏ hover)
3. –í—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
4. **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ** –≤–∏–¥–∏—Ç preview –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
6. **–ü—Ä–∏ —É—Å–ø–µ—Ö–µ** preview –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ URL —Å —Å–µ—Ä–≤–µ—Ä–∞
7. **–ü—Ä–∏ –æ—à–∏–±–∫–µ** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ + –æ—Ç–∫–∞—Ç –∫ —Å—Ç–∞—Ä–æ–º—É –∞–≤–∞—Ç–∞—Ä—É
8. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –∞–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram headers
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å. 5 –ú–ë)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è MIME —Ç–∏–ø–∞ (—Ç–æ–ª—å–∫–æ JPEG/PNG/WebP)
- ‚úÖ –°—Ç–∞—Ä—ã–π –∞–≤–∞—Ç–∞—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è
- ‚úÖ –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–∞–ø–∫—É `media/avatars/`
- ‚úÖ Rate limiting —á–µ—Ä–µ–∑ `ProfileUpdateThrottle`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### Backend
```
backend/
‚îú‚îÄ‚îÄ apps/users/
‚îÇ   ‚îú‚îÄ‚îÄ models.py                    # + avatar –ø–æ–ª–µ –≤ Profile
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py               # + avatar_url –≤ ProfileSerializer
‚îÇ   ‚îú‚îÄ‚îÄ views.py                     # + UploadAvatarView
‚îÇ   ‚îú‚îÄ‚îÄ urls.py                      # + profile/avatar/ route
‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 0007_profile_avatar.py   # –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è avatar
‚îÇ   ‚îî‚îÄ‚îÄ tests/
‚îÇ       ‚îî‚îÄ‚îÄ test_avatar_upload.py    # 13 —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ media/avatars/                   # –ü–∞–ø–∫–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–≤
‚îî‚îÄ‚îÄ TEST_AVATAR.md                   # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
```

### Frontend
```
frontend/src/
‚îú‚îÄ‚îÄ types/profile.ts                 # + avatar_url?: string | null
‚îú‚îÄ‚îÄ services/api.ts                  # + uploadAvatar() –º–µ—Ç–æ–¥
‚îî‚îÄ‚îÄ pages/ProfilePage.tsx            # + –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞
```

---

## üöÄ API Reference

### POST /api/v1/users/profile/avatar/

**–ó–∞–≥—Ä—É–∑–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞**

**Headers:**
```
X-Telegram-Id: <telegram_user_id>
X-Telegram-First-Name: <first_name>
Content-Type: multipart/form-data
```

**Body:**
```
avatar: <file>  (JPEG/PNG/WebP, –º–∞–∫—Å. 5 –ú–ë)
```

**Response 200:**
```json
{
  "id": 123,
  "username": "testuser",
  "email": "user@example.com",
  "profile": {
    "full_name": "Test User",
    "avatar_url": "http://example.com/media/avatars/test_xyz.jpg",
    ...
  }
}
```

**Errors:**
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç/—Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### curl
```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
curl -X POST http://localhost:8000/api/v1/users/profile/avatar/ \
  -H "X-Telegram-Id: 123456789" \
  -F "avatar=@/path/to/photo.jpg"

# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
curl http://localhost:8000/api/v1/users/profile/ \
  -H "X-Telegram-Id: 123456789"
```

### JavaScript
```javascript
const file = document.querySelector('input[type="file"]').files[0];
const profile = await api.uploadAvatar(file);
console.log(profile.avatar_url);
```

---

## üÜï –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 2025-11-25: –£–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ß—Ç–æ –±—ã–ª–æ —É–ª—É—á—à–µ–Ω–æ:

#### 1. ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞:** –í–∞–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∞—Å—å –≤–æ view, –Ω–µ –±—ã–ª–æ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø—Ä–∞–≤–¥—ã
- **–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω `backend/apps/users/validators.py` —Å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏ –∏ view
  - –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
  - –ï–¥–∏–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

#### 2. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ —Å—Ç–∞—Ä—ã–π —É–¥–∞–ª—è–ª—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
- **–†–µ—à–µ–Ω–∏–µ:** –ú–µ—Ç–æ–¥ `Profile.set_avatar()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—É—Ç–∏
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
  - –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤–Ω–µ MEDIA_ROOT
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏

#### 3. ‚úÖ Cache busting –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ë—Ä–∞—É–∑–µ—Ä –∫–µ—à–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–π –∞–≤–∞—Ç–∞—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–µ `avatar_version` –∏ query-–ø–∞—Ä–∞–º–µ—Ç—Ä `?v=N` –≤ URL
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ –±–µ–∑ ctrl+F5
  - –í–µ—Ä—Å–∏—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
  - –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏

#### 4. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 401/403 –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª –æ–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- **–†–µ—à–µ–Ω–∏–µ:** –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã `UnauthorizedError` –∏ `ForbiddenError`
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
  - –ü–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ –∏–∑ Telegram"
  - UI –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - –û—Ç–∫–∞—Ç –∫ —Å—Ç–∞—Ä–æ–º—É –∞–≤–∞—Ç–∞—Ä—É –ø—Ä–∏ –æ—à–∏–±–∫–µ

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:
- **–ë—ã–ª–æ:** 13 —Ç–µ—Å—Ç–æ–≤
- **–°—Ç–∞–ª–æ:** 22 —Ç–µ—Å—Ç–∞ (+9 –Ω–æ–≤—ã—Ö)
- **–î–æ–±–∞–≤–ª–µ–Ω–æ:**
  - 3 —Ç–µ—Å—Ç–∞ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
  - 4 —Ç–µ—Å—Ç–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è/cache busting
  - 2 —Ç–µ—Å—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ 22 —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
1. `backend/apps/users/validators.py` - —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏
2. `backend/apps/users/models.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ avatar_version –∏ –º–µ—Ç–æ–¥ set_avatar()
3. `backend/apps/users/migrations/0008_add_avatar_validators_and_version.py` - –º–∏–≥—Ä–∞—Ü–∏—è
4. `backend/apps/users/serializers.py` - –æ–±–Ω–æ–≤–ª–µ–Ω get_avatar_url() –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
5. `backend/apps/users/views.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ –∏ set_avatar()
6. `frontend/src/services/api.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã UnauthorizedError, ForbiddenError
7. `frontend/src/pages/ProfilePage.tsx` - —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
8. `backend/apps/users/tests/test_avatar_upload.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ 9 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

---

## üí° –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞/—Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ URL
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤ (CDN)
- [ ] Crop tool –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GIF –∞–≤–∞—Ç–∞—Ä–æ–≤
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∞–≤–∞—Ç–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django: `tail -f backend/logs/django.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `python manage.py test apps.users.tests.test_avatar_upload --settings=config.settings.test`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, —É–ª—É—á—à–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-25
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-25 (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è, cache busting, —É–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
