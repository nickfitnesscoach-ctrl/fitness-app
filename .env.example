# =============================================================================
# EatFit24 — Environment Variables (Template)
# =============================================================================
# Этот файл — КОРНЕВОЙ ШАБЛОН для всех сервисов (backend + bot).
#
# ⚠️  ВАЖНО:
# - Смотрите backend/.env.example для чистого backend-only шаблона
# - Смотрите bot/.env.example для чистого bot-only шаблона
# - AI Proxy имеет отдельный репо с собственным .env.example
#
# Скопируйте этот файл в .env и заполните реальными значениями.
# НИКОГДА не коммитьте .env с секретами.
# =============================================================================


# =============================================================================
# ENVIRONMENT
# =============================================================================

# App environment (safety check в production.py)
# ОБЯЗАТЕЛЬНО: dev для development, prod для production
APP_ENV=dev

# Модуль настроек Django (SSOT для выбора settings)
# ОБЯЗАТЕЛЬНО: config.settings.local для dev, config.settings.production для prod
DJANGO_SETTINGS_MODULE=config.settings.local

# Имя docker-compose проекта (для изоляции DEV/PROD окружений)
COMPOSE_PROJECT_NAME=eatfit24_dev

# Debug режим (ЗАПРЕЩЕН в prod)
DEBUG=true

# Основной домен проекта
DOMAIN_NAME=localhost

# ENV (опционально, для validation в entrypoint.sh)
# Используется только в bash-скриптах, не в Python коде
# ENV=dev


# =============================================================================
# DJANGO CORE (BACKEND)
# =============================================================================

# Django secret key (генерация: openssl rand -hex 32)
SECRET_KEY=dev-secret-key-change-in-prod

# Разрешённые хосты (через запятую)
ALLOWED_HOSTS=localhost,127.0.0.1,backend

# CSRF trusted origins (через запятую, с протоколом)
CSRF_TRUSTED_ORIGINS=http://localhost:5173

# CORS allowed origins (через запятую, с протоколом)
CORS_ALLOWED_ORIGINS=http://localhost:5173


# =============================================================================
# DATABASE (PostgreSQL)
# =============================================================================

POSTGRES_DB=eatfit24_dev
POSTGRES_USER=eatfit24_dev
POSTGRES_PASSWORD=dev-password
POSTGRES_HOST=db
POSTGRES_PORT=5432


# =============================================================================
# REDIS / CACHE / CELERY
# =============================================================================

# Redis URL (cache + Celery broker/backend)
REDIS_URL=redis://redis:6379/0

# Celery broker и result backend
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1

# Celery timezone (для Beat crontab)
CELERY_TIMEZONE=Europe/Moscow


# =============================================================================
# TELEGRAM (BACKEND + BOT)
# =============================================================================

# Telegram bot token (от @BotFather)
TELEGRAM_BOT_TOKEN=<your-telegram-bot-token>

# Bot API secret (для X-Bot-Secret header в запросах bot -> Django)
# Генерация: openssl rand -hex 32
TELEGRAM_BOT_API_SECRET=<your-bot-api-secret>

# ID администраторов Telegram (через запятую)
# ВАЖНО: используйте ТОЛЬКО эту переменную (не BOT_ADMIN_ID, не ADMIN_IDS)
TELEGRAM_ADMINS=310151740


# =============================================================================
# BILLING — YOOKASSA (BACKEND ONLY)
# =============================================================================

YOOKASSA_SHOP_ID=<your-shop-id>
YOOKASSA_SECRET_KEY=<test_... или live_...>
YOOKASSA_MODE=test

YOOKASSA_RETURN_URL=http://localhost:5173/payment-success
ALLOWED_RETURN_URL_DOMAINS=localhost,127.0.0.1

YOOKASSA_WEBHOOK_URL=https://example.com/api/billing/webhook/yookassa/
YOOKASSA_WEBHOOK_VERIFY_SIGNATURE=true

BILLING_RECURRING_ENABLED=false
BILLING_STRICT_MODE=true
BILLING_LOG_EVENTS=true


# =============================================================================
# AI PROXY (BACKEND SIDE)
# =============================================================================

# AI Proxy URL (для photo-analysis: backend -> ai-proxy)
# Dev (если ai-proxy в docker): http://ai-proxy:8001
# Prod (отдельный сервер): http://185.171.80.128:8001
AI_PROXY_URL=http://ai-proxy:8001

# AI Proxy Secret (для аутентификации backend -> ai-proxy)
# ОБЯЗАТЕЛЬНО: должен совпадать с API_PROXY_SECRET на ai-proxy сервере
AI_PROXY_SECRET=dev-ai-proxy-secret

# Включить async AI обработку
AI_ASYNC_ENABLED=true


# =============================================================================
# OPENROUTER AI (BOT ONLY, для генерации планов питания)
# =============================================================================

# OpenRouter API Key (используется ботом для генерации персональных планов)
# ВАЖНО: backend НЕ использует этот ключ
OPENROUTER_API_KEY=<your-openrouter-key>

# OpenRouter model (для бота)
OPENROUTER_MODEL=meta-llama/llama-3.1-70b-instruct

# OpenRouter base URL (для бота)
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1


# =============================================================================
# DJANGO API INTEGRATION (BOT -> BACKEND)
# =============================================================================

# Django API URL (бот вызывает Django REST API)
# Docker dev: http://backend:8000/api/v1
# Production: https://eatfit24.ru/api/v1
DJANGO_API_URL=http://backend:8000/api/v1


# =============================================================================
# TELEGRAM WEBAPP (BOT + FRONTEND)
# =============================================================================

# Telegram Mini App URL
WEB_APP_URL=http://localhost:3000

# Trainer panel URL (SSOT - полный URL панели)
# Dev: http://localhost:3000/panel
# Prod: https://eatfit24.ru/app/panel
TRAINER_PANEL_URL=http://localhost:3000/panel


# =============================================================================
# SECURITY (PRODUCTION HARDENING)
# =============================================================================

SECURE_SSL_REDIRECT=false
SESSION_COOKIE_SECURE=false
CSRF_COOKIE_SECURE=false

SECURE_HSTS_SECONDS=0
SECURE_HSTS_INCLUDE_SUBDOMAINS=false
SECURE_HSTS_PRELOAD=false


# =============================================================================
# STATIC & MEDIA (BACKEND)
# =============================================================================

STATIC_URL=/static/
STATIC_ROOT=/app/staticfiles

MEDIA_URL=/media/
MEDIA_ROOT=/app/media

STATICFILES_STORAGE=whitenoise.storage.CompressedManifestStaticFilesStorage


# =============================================================================
# SERVICE FLAGS (BACKEND)
# =============================================================================

# Запустить миграции при старте (1 = да, 0 = нет)
RUN_MIGRATIONS=1

# Собрать статику при старте (1 = да, 0 = нет)
RUN_COLLECTSTATIC=0

# Строгий режим миграций (1 = да, 0 = нет)
MIGRATIONS_STRICT=1


# =============================================================================
# TRUSTED PROXIES (BACKEND, для audit logs)
# =============================================================================

# Включить trusted proxies
TRUSTED_PROXIES_ENABLED=true

# Список доверенных прокси (через запятую)
TRUSTED_PROXIES=172.0.0.0/8,127.0.0.1


# =============================================================================
# API / SWAGGER (BACKEND)
# =============================================================================

# Включить Swagger UI (ТОЛЬКО для dev)
SWAGGER_ENABLED=true


# =============================================================================
# TELEGRAM WEBAPP DEBUG (BACKEND)
# =============================================================================

# Debug mode для webapp (ЗАПРЕЩЕН в prod, контролируется production.py)
WEBAPP_DEBUG_MODE_ENABLED=true


# =============================================================================
# BOT SETTINGS (опционально, с дефолтами)
# =============================================================================

# FSM storage type (memory для dev, redis для prod)
FSM_STORAGE_TYPE=memory

# Redis settings (если FSM_STORAGE_TYPE=redis)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# Environment (development или production)
ENVIRONMENT=development

# Feature flags
FEATURE_PERSONAL_PLAN=on


# =============================================================================
# ЗАПРЕЩЁННЫЕ ПЕРЕМЕННЫЕ (см. ENV_CONTRACT.md)
# =============================================================================
# ❌ OPENAI_API_KEY (не используется)
# ❌ BOT_ADMIN_ID (используйте TELEGRAM_ADMINS)
# ❌ ADMIN_IDS (используйте TELEGRAM_ADMINS)
# ❌ DATABASE_URL (используйте POSTGRES_*)
# ❌ DJANGO_CACHE_BACKEND (используйте REDIS_URL)
#
# См. также:
# - backend/.env.example — чистый backend-only шаблон
# - bot/.env.example — чистый bot-only шаблон
# - backend/docs/ENV_CONTRACT.md — контракт backend
# - bot/docs/ENV_CONTRACT.md — контракт bot
# - docs/ENV_MIGRATION_GUIDE.md — гайд по миграции
