# =============================================================================
# EatFit24 Backend — Environment Variables (Template)
# =============================================================================
# Скопируйте в .env и заполните реальными значениями.
# НИКОГДА не коммитьте .env с секретами.
# =============================================================================


# =============================================================================
# ENVIRONMENT
# =============================================================================

# App environment (safety check в production.py)
# ОБЯЗАТЕЛЬНО: prod для production
APP_ENV=prod

# Модуль настроек Django (SSOT для выбора settings)
# ОБЯЗАТЕЛЬНО: config.settings.production для prod
DJANGO_SETTINGS_MODULE=config.settings.production

# Debug режим (ЗАПРЕЩЕН в prod)
DEBUG=false

# ENV (опционально, для validation в entrypoint.sh)
# Используется только в bash-скриптах, не в Python коде
# ENV=prod


# =============================================================================
# DJANGO CORE
# =============================================================================

# Django secret key (генерация: openssl rand -hex 32)
# ОБЯЗАТЕЛЬНО: должен быть уникальным и сложным в prod
SECRET_KEY=<REPLACE_ME>

# Разрешённые хосты (через запятую)
# ОБЯЗАТЕЛЬНО: только реальные домены сайта
# Healthcheck использует Host: eatfit24.ru header, не требует "backend" или "localhost"
ALLOWED_HOSTS=eatfit24.ru,www.eatfit24.ru

# CSRF trusted origins (через запятую, с протоколом https://)
CSRF_TRUSTED_ORIGINS=https://eatfit24.ru,https://www.eatfit24.ru

# CORS allowed origins (через запятую, с протоколом)
CORS_ALLOWED_ORIGINS=https://eatfit24.ru,https://www.eatfit24.ru


# =============================================================================
# DATABASE (PostgreSQL ONLY)
# =============================================================================

# Database credentials
# ОБЯЗАТЕЛЬНО: используйте сложные пароли в prod
POSTGRES_DB=eatfit24
POSTGRES_USER=eatfit24
POSTGRES_PASSWORD=<REPLACE_ME>
POSTGRES_HOST=db
POSTGRES_PORT=5432


# =============================================================================
# REDIS / CACHE / CELERY
# =============================================================================

# Redis URL (cache + Celery broker/backend)
# Формат: redis://[password@]host:port/db
REDIS_URL=redis://redis:6379/1

# Celery broker и result backend
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/2

# Celery timezone (для Beat crontab)
CELERY_TIMEZONE=Europe/Moscow


# =============================================================================
# TELEGRAM
# =============================================================================

# Telegram bot token (от @BotFather)
# ОБЯЗАТЕЛЬНО
TELEGRAM_BOT_TOKEN=<REPLACE_ME>

# ID администраторов Telegram (через запятую)
# ОБЯЗАТЕЛЬНО: ваш Telegram user ID
# Для Browser Debug Mode добавьте 999999999 (DEV only)
TELEGRAM_ADMINS=310151740,999999999


# =============================================================================
# BILLING (YooKassa)
# =============================================================================

# YooKassa Shop ID
# ОБЯЗАТЕЛЬНО для prod
YOOKASSA_SHOP_ID=<REPLACE_ME>

# YooKassa Secret Key (live_... для prod, test_... для dev)
# ОБЯЗАТЕЛЬНО для prod
YOOKASSA_SECRET_KEY=<REPLACE_ME>

# YooKassa mode (prod или test)
# ОБЯЗАТЕЛЬНО: prod для production
YOOKASSA_MODE=prod

# Return URL после оплаты
YOOKASSA_RETURN_URL=https://eatfit24.ru/payment-success

# Разрешённые домены для return_url
ALLOWED_RETURN_URL_DOMAINS=eatfit24.ru,www.eatfit24.ru

# Webhook URL для YooKassa
YOOKASSA_WEBHOOK_URL=https://eatfit24.ru/api/billing/webhook/yookassa/

# Проверять подпись webhook
YOOKASSA_WEBHOOK_VERIFY_SIGNATURE=true

# Рекуррентные платежи (авто-продление)
BILLING_RECURRING_ENABLED=true

# Строгий режим биллинга
BILLING_STRICT_MODE=true

# Логировать события биллинга
BILLING_LOG_EVENTS=true


# =============================================================================
# AI PROXY (BACKEND SIDE)
# =============================================================================

# AI Proxy URL (внешний сервер, НЕ docker internal)
# Для production: http://IP:PORT или https://domain
AI_PROXY_URL=http://185.171.80.128:8001

# AI Proxy Secret (для аутентификации backend -> ai-proxy)
# ОБЯЗАТЕЛЬНО: должен совпадать с API_PROXY_SECRET на ai-proxy сервере
AI_PROXY_SECRET=<REPLACE_ME>

# Включить async AI обработку
AI_ASYNC_ENABLED=true


# =============================================================================
# SECURITY (PRODUCTION HARDENING)
# =============================================================================

# SSL Redirect (включить в prod за nginx)
SECURE_SSL_REDIRECT=true

# Secure cookies (включить в prod)
SESSION_COOKIE_SECURE=true
CSRF_COOKIE_SECURE=true

# HSTS (включить в prod)
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=true
SECURE_HSTS_PRELOAD=true


# =============================================================================
# STATIC & MEDIA
# =============================================================================

STATIC_URL=/static/
STATIC_ROOT=/app/staticfiles

MEDIA_URL=/media/
MEDIA_ROOT=/app/media

STATICFILES_STORAGE=whitenoise.storage.CompressedManifestStaticFilesStorage


# =============================================================================
# SERVICE FLAGS
# =============================================================================

# Запустить миграции при старте (1 = да, 0 = нет)
RUN_MIGRATIONS=1

# Собрать статику при старте (1 = да, 0 = нет)
RUN_COLLECTSTATIC=1

# Строгий режим миграций (1 = да, 0 = нет)
MIGRATIONS_STRICT=1


# =============================================================================
# TRUSTED PROXIES (для audit logs, получение реального IP)
# =============================================================================

# Включить trusted proxies
TRUSTED_PROXIES_ENABLED=true

# Список доверенных прокси (через запятую)
# Обычно: docker subnet (172.x.x.x)
TRUSTED_PROXIES=172.0.0.0/8


# =============================================================================
# API / SWAGGER
# =============================================================================

# Включить Swagger UI (ТОЛЬКО для dev)
SWAGGER_ENABLED=false


# =============================================================================
# TELEGRAM WEBAPP DEBUG
# =============================================================================

# Debug mode для webapp (ЗАПРЕЩЕН в prod, контролируется production.py)
WEBAPP_DEBUG_MODE_ENABLED=false


# =============================================================================
# ЗАПРЕЩЁННЫЕ ПЕРЕМЕННЫЕ ДЛЯ BACKEND
# =============================================================================
# Backend НЕ ДОЛЖЕН содержать:
# - OPENROUTER_API_KEY (только в bot и ai-proxy)
# - OPENAI_API_KEY (только в ai-proxy)
# - Дублирующие admin vars: BOT_ADMIN_ID, ADMIN_IDS (используйте TELEGRAM_ADMINS)
# - DATABASE_URL (используйте POSTGRES_* напрямую)
# - DJANGO_CACHE_BACKEND (используйте REDIS_URL)
