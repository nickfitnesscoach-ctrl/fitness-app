# –ü–æ–ª–∏—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî EatFit24

## –ü—Ä–∏–Ω—Ü–∏–ø (Golden Rule)

> **"If it runs on the server ‚Äî it's UTC."**

**–ü—Ä–∞–≤–∏–ª–æ:**
- **Backend & Infrastructure** ‚Üí –≤—Å–µ–≥–¥–∞ UTC
- **UI & User-facing** ‚Üí –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–æ—á–µ–º—É UTC:**
- –£–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
- –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –ª–µ—Ç–Ω–µ–µ/–∑–∏–º–Ω–µ–µ –≤—Ä–µ–º—è
- –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ—Ñ—Ç–∞
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ª–æ–≥–∞–º–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º, –∞–ª–µ—Ä—Ç–∞–º–∏

---

## –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Backend (UTC-native)

–í—Å–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ **UTC**:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–∞–π–º–∑–æ–Ω–∞ | –ü—Ä–æ–≤–µ—Ä–∫–∞ |
|-----------|----------|----------|
| Docker containers | UTC | `docker exec <container> date` |
| PostgreSQL | UTC | `SELECT now();` |
| Redis | UTC | Timestamps –≤ —Å–µ–∫—É–Ω–¥–∞—Ö —Å Epoch (UTC) |
| Celery Beat | UTC (system) | –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç UTC |
| Celery Worker | UTC (system) | Timestamps –≤ –ª–æ–≥–∞—Ö |
| Nginx | UTC | Access logs |

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å UTC
docker exec eatfit24-backend-1 date
docker exec eatfit24-celery-beat-1 date
docker exec eatfit24-celery-worker-1 date
docker exec eatfit24-db-1 date
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
UTC +0000 - 2025-12-24 12:30:45
```

---

### Django (UTC + Moscow presentation)

Django **—Ö—Ä–∞–Ω–∏—Ç –≤ UTC**, –Ω–æ **–ø—Ä–µ–∑–µ–Ω—Ç—É–µ—Ç –≤ Moscow**:

```python
# settings/base.py
TIME_ZONE = 'Europe/Moscow'  # –î–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ (–Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç)
USE_TZ = True                 # –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ UTC!
```

**–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- `timezone.now()` ‚Üí **UTC aware datetime**
- Database timestamps ‚Üí **UTC**
- Django admin UI ‚Üí **–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Moscow time**
- API responses ‚Üí **UTC ISO 8601** (–µ—Å–ª–∏ –Ω–µ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ —è–≤–Ω–æ)

### Celery timezone (–∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã)

Celery Beat –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–π–º–∑–æ–Ω—É –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Celery:
- `app.conf.timezone`
- `app.conf.enable_utc`

**–í EatFit24:**
- `app.conf.timezone` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å `settings.TIME_ZONE`
- –ü–æ—ç—Ç–æ–º—É `crontab()` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ **Europe/Moscow**

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
docker exec eatfit24-backend-1 python - <<'PY'
from config.celery import app
print("Celery timezone:", app.conf.timezone)
print("Celery enable_utc:", app.conf.enable_utc)
PY
```

**–í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:**
- Celery `crontab(minute=0, hour="*/1")` ‚Üí —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ —Ç–∞–π–º–∑–æ–Ω–µ `app.conf.timezone`
- –í —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —ç—Ç–æ **Moscow time** (00:00, 01:00, 02:00 MSK)
- System time –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (UTC) –∏ Celery timezone ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏!

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
docker exec eatfit24-backend-1 python manage.py shell -c "
from django.utils import timezone
from django.conf import settings
print(f'TIME_ZONE: {settings.TIME_ZONE}')
print(f'USE_TZ: {settings.USE_TZ}')
print(f'Current UTC: {timezone.now()}')
print(f'Current Local: {timezone.localtime(timezone.now())}')
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
TIME_ZONE: Europe/Moscow
USE_TZ: True
Current UTC: 2025-12-24 12:30:45+00:00
Current Local: 2025-12-24 15:30:45+03:00
```

---

### Frontend & Telegram (User timezone)

**Frontend (React):**
- –ü–æ–ª—É—á–∞–µ—Ç UTC timestamps –æ—Ç API
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—É—é —Ç–∞–π–º–∑–æ–Ω—É –±—Ä–∞—É–∑–µ—Ä–∞ —á–µ—Ä–µ–∑ JavaScript `Date`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**Telegram Bot:**
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ **Moscow time** (–Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ Django `timezone.localtime()`

---

## –¢–∏–ø–∏—á–Ω—ã–µ –ª–æ–≤—É—à–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### üïê –õ–æ–≤—É—à–∫–∞ 1: Hourly –∑–∞–¥–∞—á–∏ –≤ Celery Beat

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –í config/celery.py
'cleanup-task': {
    'schedule': crontab(minute=0, hour='*/1'),  # –ö–∞–∂–¥—ã–π —á–∞—Å –≤ :00
}
```

**–í–æ–ø—Ä–æ—Å:** –í –∫–∞–∫–æ–π —Ç–∞–π–º–∑–æ–Ω–µ "–∫–∞–∂–¥—ã–π —á–∞—Å"?

**–û—Ç–≤–µ—Ç:**

Celery `crontab()` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–π–º–∑–æ–Ω–µ, —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤ `app.conf.timezone`.

–í EatFit24 —ç—Ç–æ **Europe/Moscow**, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å Django `TIME_ZONE`.

**–ü—Ä–∏–º–µ—Ä:**
- –ó–∞–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ `0 */1`
- TIME_ZONE = "Europe/Moscow"
- –ó–∞–¥–∞—á–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –≤: **00:00, 01:00, 02:00 MSK**
- –≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: **21:00, 22:00, 23:00 UTC (–ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è)**

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
–°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Beat ‚Äî —Ç–∞–º —É–∫–∞–∑–∞–Ω–æ `LocalTime` (Celery timezone):
```
LocalTime -> 2025-12-24 15:00:01  # –≠—Ç–æ Moscow time (–∏–∑ app.conf.timezone)
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–Ω–∞—Ç—å, —á—Ç–æ crontab –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `app.conf.timezone` (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ Europe/Moscow)
- –£—á–∏—Ç—ã–≤–∞—Ç—å —Å–º–µ—â–µ–Ω–∏–µ UTC ‚Üî Moscow –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- –õ–∏–±–æ —è–≤–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `app.conf.timezone = 'UTC'` (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã UTC-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è)

---

### üïë –õ–æ–≤—É—à–∫–∞ 2: –õ–æ–≥–∏ vs –±–∏–∑–Ω–µ—Å-–æ–∂–∏–¥–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ë–∏–∑–Ω–µ—Å –≥–æ–≤–æ—Ä–∏—Ç: "–ó–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ –ø–æ–ª–Ω–æ—á—å"

DevOps —Å–º–æ—Ç—Ä–∏—Ç –ª–æ–≥–∏ –≤ UTC:
```
[2025-12-24 21:00:00] Task started
```

**–í–æ–ø—Ä–æ—Å:** –≠—Ç–æ 21:00 –∏–ª–∏ –ø–æ–ª–Ω–æ—á—å?

**–û—Ç–≤–µ—Ç:** –≠—Ç–æ **00:00 Moscow = 21:00 UTC**.

**–†–µ—à–µ–Ω–∏–µ:**
- –í—Å–µ–≥–¥–∞ —É—Ç–æ—á–Ω—è—Ç—å: "–ü–æ–ª–Ω–æ—á—å –ø–æ –∫–∞–∫–æ–π —Ç–∞–π–º–∑–æ–Ω–µ?"
- –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞—Ç—å –æ–±–µ —Ç–∞–π–º–∑–æ–Ω—ã:
  ```
  Cleanup task: 00:00 MSK (21:00 UTC)
  ```
- –ü–æ–º–Ω–∏—Ç—å: –±–∏–∑–Ω–µ—Å –æ–±—ã—á–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, DevOps –≤–∏–¥–∏—Ç UTC –≤ –ª–æ–≥–∞—Ö

---

### üïí –õ–æ–≤—É—à–∫–∞ 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ –∫–æ–¥–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# ‚ùå –ü–õ–û–•–û
from datetime import datetime
now = datetime.now()  # Naive datetime!
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- `datetime.now()` ‚Üí naive datetime (–±–µ–∑ —Ç–∞–π–º–∑–æ–Ω—ã)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å DB timestamps ‚Üí –æ—à–∏–±–∫–∞ –∏–ª–∏ –Ω–µ—è–≤–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- –ü—Ä–∏ `USE_TZ=True` Django —Ä—É–≥–∞–µ—Ç—Å—è –Ω–∞ naive datetime

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚úÖ –•–û–†–û–®–û
from django.utils import timezone
now = timezone.now()  # Aware datetime –≤ UTC
```

**Golden rule:**
> **–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `datetime.now()` –≤ Django –ø—Ä–æ–µ–∫—Ç–µ —Å `USE_TZ=True`**

---

### üïì –õ–æ–≤—É—à–∫–∞ 4: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ª–µ—Ç–Ω–µ–µ/–∑–∏–º–Ω–µ–µ –≤—Ä–µ–º—è (DST)

**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**

–†–æ—Å—Å–∏—è (Europe/Moscow) **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ª–µ—Ç–Ω–µ–µ/–∑–∏–º–Ω–µ–µ –≤—Ä–µ–º—è** —Å 2014 –≥–æ–¥–∞.
–¢–µ–∫—É—â–∞—è —Ç–∞–π–º–∑–æ–Ω–∞ MSK = UTC+3 —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π.

–û–¥–Ω–∞–∫–æ –ø–æ–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è UTC –≤ backend –ø—Ä–∏–Ω—è—Ç–∞ **–Ω–µ –∏–∑-–∑–∞ –ú–æ—Å–∫–≤—ã**, –∞ –∫–∞–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

**–ü–æ—á–µ–º—É UTC –≤–∞–∂–µ–Ω –¥–∞–∂–µ –±–µ–∑ DST:**

–î–∞–∂–µ –µ—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º:
- –ò–∑–º–µ–Ω–∏—Ç—Å—è —Ä–µ–≥–∏–æ–Ω —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤
- –ü–æ—è–≤—è—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ç–∞–π–º–∑–æ–Ω–∞—Ö
- –ü—Ä–æ–µ–∫—Ç —Å—Ç–∞–Ω–µ—Ç multi-region
- –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è timezone —Å DST

UTC –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª–∞—Å—Å–æ–≤ –æ—à–∏–±–æ–∫, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å DST (Daylight Saving Time).

**–ì–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å DST:**

–ï—Å–ª–∏ –±—ã backend —Ä–∞–±–æ—Ç–∞–ª –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω–µ —Å DST (–Ω–∞–ø—Ä–∏–º–µ—Ä, Europe/London, America/New_York), —ç—Ç–æ –º–æ–≥–ª–æ –±—ã –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- **–î–≤–æ–π–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É** hourly –∑–∞–¥–∞—á –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —Å –ª–µ—Ç–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (2:00 ‚Üí 1:00)
- **–ü—Ä–æ–ø—É—Å–∫—É cron-–æ–∫–æ–Ω** –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –ª–µ—Ç–Ω–µ–µ –≤—Ä–µ–º—è (1:00 ‚Üí 3:00, –ø—Ä–æ–ø—É—â–µ–Ω —á–∞—Å 2:00)
- **–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω—É –ª–æ–≥–æ–≤** ‚Äî timestamps "–ø—Ä—ã–≥–∞—é—Ç" –Ω–∞ —á–∞—Å –Ω–∞–∑–∞–¥/–≤–ø–µ—Ä—ë–¥
- **–ù–µ—Å—Ä–∞–≤–Ω–∏–º—ã–º timestamps** –≤ –ë–î (–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ wall-clock time –¥–≤–∞–∂–¥—ã)

**–†–µ—à–µ–Ω–∏–µ (–Ω–∞—à–µ):**
- Backend –≤ UTC ‚Üí **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–∞–µ—Ç —ç—Ç–∏ —Ä–∏—Å–∫–∏**
- Django TIME_ZONE / Celery timezone ‚Üí —Ç–æ–ª—å–∫–æ –¥–ª—è presentation –∏ crontab —Ä–∞—Å—á—ë—Ç–æ–≤
- –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ª–µ—Ç–Ω–µ–µ/–∑–∏–º–Ω–µ–µ –≤—Ä–µ–º—è (–≥–¥–µ –æ–Ω –µ—Å—Ç—å) –≤–ª–∏—è–µ—Ç –¢–û–õ–¨–ö–û –Ω–∞ UI, –Ω–µ –Ω–∞ backend logic

---

## –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

### –ß–µ–∫–ª–∏—Å—Ç UTC-compliance

- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ UTC: `docker exec <container> date`
- [ ] –ï—Å–ª–∏ Django/Python: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `timezone.now()`, –∞ –Ω–µ `datetime.now()`
- [ ] –ï—Å–ª–∏ cron/scheduler: –ø–æ–Ω–∏–º–∞–µ—Ç–µ –≤ –∫–∞–∫–æ–π —Ç–∞–π–º–∑–æ–Ω–µ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è —Å UTC timestamps
- [ ] Database timestamps –≤ UTC
- [ ] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ISO 8601 —Å timezone (`+00:00` –∏–ª–∏ `Z`)

### –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# 1. System time
docker exec <container> date

# 2. Python/Django time
docker exec <container> python -c "from django.utils import timezone; print(timezone.now())"

# 3. PostgreSQL time
docker exec eatfit24-db-1 psql -U eatfit24 -c "SELECT now();"

# 4. Redis time (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è EXPIREAT)
docker exec eatfit24-redis-1 redis-cli TIME
```

---

## Presentation layer (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### –ì–¥–µ –ª–æ–∫–∞–ª–∏–∑—É–µ—Ç—Å—è –≤—Ä–µ–º—è:

**Frontend:**
```javascript
// API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç UTC ISO 8601
const utcTime = "2025-12-24T12:30:45Z";

// JavaScript –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ
const date = new Date(utcTime);
console.log(date.toLocaleString()); // –í —Ç–∞–π–º–∑–æ–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞
```

**Django Admin:**
```python
# Django –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤ TIME_ZONE
# settings: TIME_ZONE = "Europe/Moscow"
# –í –∞–¥–º–∏–Ω–∫–µ –±—É–¥–µ—Ç: 2025-12-24 15:30:45 (MSK)
```

**Telegram Bot:**
```python
from django.utils import timezone

utc_time = payment.created_at  # UTC –∏–∑ –ë–î
local_time = timezone.localtime(utc_time)  # Moscow time

await message.answer(
    f"–ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞–Ω: {local_time.strftime('%d.%m.%Y %H:%M')} –ú–°–ö"
)
```

---

## –ú–∏–≥—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å TIME_ZONE)

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —á–∏—Å—Ç—ã–π UTC

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º —Ä–µ—à–∏—Ç–µ —É–±—Ä–∞—Ç—å Moscow –∏–∑ Django –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ UTC:

1. **–ò–∑–º–µ–Ω–∏—Ç—å settings:**
   ```python
   TIME_ZONE = 'UTC'  # –ë—ã–ª–æ: Europe/Moscow
   USE_TZ = True
   ```

2. **–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å Celery Beat:**
   ```bash
   ./scripts/reset-celery-beat.sh
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ crontab –∑–∞–¥–∞—á–∏:**
   - –¢–µ–ø–µ—Ä—å –æ–Ω–∏ –±—É–¥—É—Ç –≤ UTC!
   - `crontab(minute=0, hour='*/1')` ‚Üí 00:00, 01:00, 02:00 **UTC**

4. **–û–±–Ω–æ–≤–∏—Ç—å presentation layer:**
   - Frontend: –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ local time)
   - Telegram: —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è –∏–ª–∏ –±—Ä–∞—Ç—å –∏–∑ user profile

5. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**

---

## Best Practices

### ‚úÖ DO

- **–í—Å–µ–≥–¥–∞** –∏—Å–ø–æ–ª—å–∑—É–π `timezone.now()` –≤ Django
- **–í—Å–µ–≥–¥–∞** —Ö—Ä–∞–Ω–∏ timestamps –≤ UTC –≤ –ë–î
- **–í—Å–µ–≥–¥–∞** —É–∫–∞–∑—ã–≤–∞–π timezone –≤ API responses (ISO 8601)
- **–Ø–≤–Ω–æ** –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è local time
- **–ü—Ä–æ–≤–µ—Ä—è–π** system time –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### ‚ùå DON'T

- **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `datetime.now()` –≤ Django —Å `USE_TZ=True`
- **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ —Ö—Ä–∞–Ω–∏ naive datetime –≤ –ë–î
- **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–π timezone ‚Äî –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π
- **–ù–µ –¥–µ–ª–∞–π** –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É —Å —Ä–∞–∑–Ω—ã–º–∏ timezone –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- **–ù–µ –ø–æ–ª–∞–≥–∞–π—Å—è** –Ω–∞ system time –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–π Django timezone)

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–ó–∞–¥–∞—á–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ –≤–æ–≤—Ä–µ–º—è"

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

1. **–ü—Ä–æ–≤–µ—Ä—å TIME_ZONE –≤ Django:**
   ```bash
   docker exec eatfit24-backend-1 python manage.py shell -c "
   from django.conf import settings
   print(settings.TIME_ZONE)
   "
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å system time –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
   ```bash
   docker exec eatfit24-celery-beat-1 date
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Beat** ‚Äî —Ç–∞–º —É–∫–∞–∑–∞–Ω–æ `LocalTime`:
   ```bash
   docker logs eatfit24-celery-beat-1 | grep LocalTime
   ```

4. **–ü–µ—Ä–µ—Å—á–∏—Ç–∞–π —Å–º–µ—â–µ–Ω–∏–µ:**
   - Moscow = UTC+3
   - 00:00 MSK = 21:00 UTC (–ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è)

---

### –ü—Ä–æ–±–ª–µ–º–∞: "Timestamps –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏"

**–ü—Ä–∏—á–∏–Ω—ã:**
- –†–∞–∑–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–π–º–∑–æ–Ω–∞—Ö
- Naive datetime vs aware datetime
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Å—å —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ UTC
2. –£–±–µ–¥–∏—Å—å —á—Ç–æ Django `USE_TZ=True`
3. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ `timezone.now()`

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Celery Beat Operations](../operations/celery-beat.md) ‚Äî —Ç–∞–π–º–∑–æ–Ω–∞ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
- [Backend Settings](../../backend/config/settings/base.py) ‚Äî TIME_ZONE –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [API Documentation](../api/README.md) ‚Äî —Ñ–æ—Ä–º–∞—Ç timestamps –≤ API (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞       | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                                                  | –ê–≤—Ç–æ—Ä         |
|------------|------------------------------------------------------------|---------------|
| 2025-12-24 | –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ UTC                            | DevOps Agent  |
| 2025-12-24 | –£—Ç–æ—á–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ DST –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ timezone –¥–ª—è Celery    | DevOps Agent  |
